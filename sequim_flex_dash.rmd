---
title: "Last 48 Hours of  Weather"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
runtime: shiny
---

```{r global, include=FALSE}
# load data in 'global' chunk so it can be shared by all users of the dashboard
library(shiny)
library(ggplot2)
library(DT)
library(dplyr)
source("utils.R")
```

Input {.sidebar}
-----------------------------------------------------------------------

```{r}
# Get the data 
df <- getData()

# Create a selector
weather_vars <- c(
  "UV", 
  "Humidity", 
  "Temperature", 
  "Pressure", 
  "Precip"
)

station_vars <- list(
  "Albany, NY" = "KNYALBAN124",
  "Antioch, TN" = "KTNANTIO26",
  "Dallas, TX" = "KTXDALLA724",
  "Seattle, WA" = "KWASEATT2743", 
  "Sequim, WA" = "KWASEQUI431", 
  "Montreal, CAN" = "IWESTMOU2"
)

selectInput(inputId = "stationID",
            label = h4("Choose City"),
            choices = names(station_vars),
            selected = "Seattle, WA")

selectInput(inputId = "variable",
            label = h4("Choose Variable to Plot"),
            choices = c("Temperature", "Precip"),
            selected = "Temperature")

# filter to last 48hrs from specific city
data <- reactive({
    filter(df, stationID == station_vars[input$stationID]) |>
    arrange(desc(Time)) |> 
    head(n=48)
})
```

Row
------------------------------------------------------------------

```{r}

dataPlot <- reactive({
  getPlot( data(), input$variable, input$stationID )
})

renderPlot({
  dataPlot()
})
```

Row
-------------------------------------------------------------

```{r}
renderDT(rownames = FALSE,
         server = FALSE,
         options = list(bPaginate = FALSE,
                        dom = 't',
                        ordering=F,
                        scrollY = "350px"),
         {data() %>% arrange(desc("Time")) %>%
             mutate("Time" = as.character(`Time`))
         })
```